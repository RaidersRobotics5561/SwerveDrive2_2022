/*feel pain AutoTarget.cppCreatedon:Feb25,2020Author:5561*/#include"Robot.h"#include"control_pid.hpp"#include"Encoders.hpp"#include"DriveControl.hpp"#include"Lookup.hpp"#include"Enums.hpp"#include<math.h>/*******************************************************************************Function:AutoTargeting**Description:Autotargetingfunction.******************************************************************************/T_AutoTargetStatesAutoTargeting(T_AutoTargetStatesL_CurrentState,boolL_Activate,doubleL_DriverAxis1,doubleL_DriverAxis2,doubleL_DriverAxis3,doubleL_RawTargetVisionAngle,doubleL_RawTargetVisionDistance,doubleL_RobotAngle,double*L_RobotTargetAngle,doubleL_UpperRollerSpeed,doubleL_LowerRollerSpeed,double*L_UpperRollerSpeedReq,double*L_LowerRollerSpeedReq,double*L_BeltPowerReq){//doubleL_RobotTargetAngle=0;doubleL_UpperRollerSpeedError=0;doubleL_LowerRollerSpeedError=0;doubleL_RobotAngleError=0;boolL_AbortTargeting=false;if((fabs(L_DriverAxis1)>0)||(fabs(L_DriverAxis2)>0)||(fabs(L_DriverAxis3)>0)){L_AbortTargeting=true;}L_RobotAngleError=fabs(L_RobotAngle-*L_RobotTargetAngle);L_UpperRollerSpeedError=fabs(L_UpperRollerSpeed-*L_UpperRollerSpeedReq);L_LowerRollerSpeedError=fabs(L_LowerRollerSpeed-*L_LowerRollerSpeedReq);/*First,weneedtolocatethetarget.Inordertoreliablydothis,weneedthefollowingcriteriamet:*-Gyrosaysrobotispointingstraightahead*-Visionsystemisprovidingadistance*-Visionsystemisprovidinganangle**/if(L_AbortTargeting==true){L_CurrentState=E_NotActive;*L_RobotTargetAngle=0.0;*L_UpperRollerSpeedReq=0.0;*L_LowerRollerSpeedReq=0.0;*L_BeltPowerReq=0.0;}elseif((L_Activate==true)&&(L_RawTargetVisionAngle>K_TargetVisionAngleMin)&&(L_RawTargetVisionAngle<K_TargetVisionAngleMax)&&(L_RawTargetVisionDistance>K_TargetVisionDistanceMin)&&(L_RawTargetVisionDistance<K_TargetVisionDistanceMax)&&(L_CurrentState==E_NotActive)){/*Ok,weseemtobeabletoseethetargetanditisbeingrequestedthatwebecomeactive.*Wearealsonotcurrentlyactive.*/DesiredRollerSpeed(L_RawTargetVisionDistance,L_RawTargetVisionAngle,L_UpperRollerSpeedReq,L_LowerRollerSpeedReq);*L_RobotTargetAngle=K_TargetVisionAngle;*L_BeltPowerReq=0.0;/*Ok,let'sgotothenextstep:*/L_CurrentState=E_TargetFoundRotateBotAndRollerSpinUp;}elseif((L_RobotAngleError<=K_TargetVisionAngleErrorMax)&&(L_UpperRollerSpeedError<=K_TargetVisionUpperRollerErrorMax)&&(L_LowerRollerSpeedError<=K_TargetVisionLowerRollerErrorMax)&&(L_CurrentState>E_NotActive)&&(L_CurrentState<E_MoveBallsToRollers)){L_CurrentState=E_MoveBallsToRollers;*L_BeltPowerReq=0.9;}return(L_CurrentState);}